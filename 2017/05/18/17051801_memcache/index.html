<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>Memcached 服务搭建 | Khazix's Blog</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="Khazix Li"><meta name="designer" content="minfive"><meta name="keywords" content="demon, demonxian3, demonxian3博客, 技术博客, 前端, 后端, web, 算法, 渗透测试, linux, 运维, 服务搭建, C语言, bash, php, javascript, js, python, khzix, hexo, skapp, docker, centos, ubuntu, kali"><meta name="description" content="技术文章"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="demonxian3.github.io/2017/05/18/17051801_memcache/index.html"><link rel="icon" type="image/png" href="favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Khazix"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/system/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Khazix" alt="Khazix">Khazix</a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/bookmark" alt="收藏" title="收藏">收藏</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"></div><header class="post__info"><h1 class="post__title">Memcached 服务搭建</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="http://github.com/demonxian3">Demon</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2017-05-18</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"></ul></div></div></header><div class="post__content"><div class="toc"><label for="toc-toggle" class="toc-toggle">M</label><input id="toc-toggle" type="checkbox"><ul><li><a href="#0x00-jian-jie">0x00 简介</a></li><li><a href="#0x01-huan-jing-zhun-bei">0x01 环境准备</a></li><li><a href="#0x02-an-zhuang-libevent-cha-jian">0x02 安装libevent插件</a></li><li><a href="#0x03-an-zhuang-memcached-fu-wu">0x03 安装memcached服务</a></li><li><a href="#0x04-pei-zhi">0x04 配置</a></li><li><a href="#0x05-shi-yong">0x05 使用</a></li><li><a href="#0x06-xia-mian-shi-guan-yu-memcached-xiang-guan-de-cao-zuo-ming-ling">0x06 下面是关于memcached相关的操作命令</a></li><li><a href="#0x07-php-mo-kuai">0x07 php模块</a></li><li><a href="#0x08-php-jiao-ben-ce-shi-mo-kuai">0x08 php脚本测试模块</a></li></ul></div># 0x00 简介 Memcache > Memcache 作为缓存技术, 可以为数据读取加快, 减轻数据库负担, 工作原理： > 读取数据时会先读取 memcached缓存 的数据, 若无就读取 数据库，顺便存到 memcached > 写入数据时也先写到 memcached缓存 的数据, 若无则写到 数据库，同时更新 memcached<p>模式和端口</p><blockquote><p>Memcache是一个基于C/S的结构：<br>服务端：使用Memcached软件<br>客户端：使用Memcache插件 （这个插件是结合后端语言比如php python java）<br>服务端口：11211（可改）</p></blockquote><p>php 几种全局存储介质速度排名(由低到高):</p><blockquote><p>数据库<br>cookies 或 session<br>文件读写<br>memcached</p></blockquote><p>缺陷</p><blockquote><p>Memcache 数据是直接存到RAM内存中的, 若突然断电会导致数据丢失<br>因此需要通过编程实现定时将缓存数据同步到磁盘实际数据当中,<br>可以通过linux命令 sync 可以快速更新磁盘, 避免丢失</p></blockquote><p>软件清单：</p><table><thead><tr><th>名称</th><th>安装方式</th></tr></thead><tbody><tr><td>libevent依赖库</td><td><a href="http://libevent.org/" target="_blank" rel="noopener">http://libevent.org/</a></td></tr><tr><td>memcache插件</td><td><a href="http://pecl.php.net/package/memcache/" target="_blank" rel="noopener">http://pecl.php.net/package/memcache/</a></td></tr><tr><td>memcached服务</td><td><a href="http://www.memcached.org/" target="_blank" rel="noopener">http://www.memcached.org/</a></td></tr><tr><td>lamp环境</td><td>yum -y install httpd php php-mysql mysql-server</td></tr></tbody></table><p>测试操作系统: CentOS-6.5(x86_64)</p><div id="0x01-huan-jing-zhun-bei"></div><br><br><br><h1>0x01 环境准备</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> httpd php php-mysql mysql-<span class="keyword">server</span></span><br><span class="line">/etc/init.d/httpd <span class="keyword">start</span></span><br><span class="line">echo <span class="string">"&lt;?php phpinfo()?&gt;"</span> &gt; /<span class="keyword">var</span>/www/html/index.php</span><br></pre></td></tr></table></figure><p>然后用浏览器访问查看php信息，在信息里面是找不到memcache的</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/01.png" alt="01"></p><div id="0x02-an-zhuang-libevent-cha-jian"></div><br><br><br><h1>0x02 安装libevent插件</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar xf libevent<span class="number">-2.0</span><span class="number">.22</span>-stable.tar.gz</span><br><span class="line">cd libevent<span class="number">-2.0</span><span class="number">.22</span>-stable</span><br><span class="line">./configure --prefix=/usr/local/libevent &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><div id="0x03-an-zhuang-memcached-fu-wu"></div><br><br><br><h1>0x03 安装memcached服务</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar xf memcached-<span class="number">1.4</span>.<span class="number">36</span>.tar.gz</span><br><span class="line">cd memcached-<span class="number">1.4</span>.<span class="number">36</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/m</span>emcached --with-libevent=<span class="regexp">/usr/</span>local<span class="regexp">/libevent/</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>安装好后会在<code>/usr/local/memcached/bin/</code>目录下生成 memcached 命令</p><div id="0x04-pei-zhi"></div><br><br><br><h1>0x04 配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span>  /etc/profile.d/</span><br><span class="line">vim mem.sh</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"/usr/local/memcached/bin:<span class="variable">$PATH</span>"</span>  <span class="comment">#写入profile文件开机自动导入</span></span><br><span class="line">memcached -m 32 -p 11211 -d -c 8192 -u root   <span class="comment">#m分出内存大小 p 端口 d 混合模式 c 最大连接数</span></span><br><span class="line">netstat -anptu | grep memcached               <span class="comment">#查看是否启动，运行多实例更改端口即可</span></span><br><span class="line">free -m                                       <span class="comment">#可以看到内存越来越少，因为被分配出去了</span></span><br><span class="line">ps -aux | grep memcached                      <span class="comment">#查看进程pid是多少</span></span><br><span class="line"><span class="built_in">kill</span> -9 1234                                  <span class="comment">#关闭memcached服务</span></span><br><span class="line">pkill memcached                               <span class="comment">#同上</span></span><br></pre></td></tr></table></figure><div id="0x05-shi-yong"></div><br><br><br><h1>0x05 使用</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> nc telnet</span><br></pre></td></tr></table></figure><p>1)使用nc命令连接memcache</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf <span class="string">"set first 0 30 5\r<span class="subst">\n</span>mmmmm\r<span class="subst">\n</span>"</span> | nc <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">11211</span>  #存数据 （字段分别为 <span class="type">key</span>，标志，效期，长度，值 ）</span><br><span class="line">printf <span class="string">"get first\r<span class="subst">\n</span>"</span> | nc <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">11211</span>#取数据</span><br></pre></td></tr></table></figure><p>2)使用telnet命令连接memcache</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">11211</span>#然后就可以使用相关的memcached命令了</span><br></pre></td></tr></table></figure><div id="0x06-xia-mian-shi-guan-yu-memcached-xiang-guan-de-cao-zuo-ming-ling"></div><br><br><br><h1>0x06 下面是关于memcached相关的操作命令</h1><pre>
> add key1 0 30 3      #添加数据30为效期（如果写0表示永不过期） 3为大小
> set key1 0 30 3      #更新数据，不存在会自动创建
> replace key1 0 30 3  #更新数据，不存在会报错
> delete key1          #删除数据
> get key1             #获取数据
> gets key 1           #获取更多信息
> stats setting        #查看配置信息
> stats slabs          #查看slab
> stats items          #查看item
> stats size           #查看大小
</pre><div id="0x07-php-mo-kuai"></div><br><br><br><h1>0x07 php模块</h1><p>安装phpize命令可以为php添加新模块, 如果不知道是什么包可以使用 <code>yum provides */phpize</code></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install php-devel</span><br><span class="line">tar xf memcache-2.2.7.tgz</span><br><span class="line"><span class="keyword">cd</span> memcache-2.2.7</span><br><span class="line">phpize                  <span class="comment">#打模块，生成configure等文件</span></span><br><span class="line">which php-config        <span class="comment">#查看php-config路径位置</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--enable-memcache</span> <span class="params">--with-php-config=/usr/bin/php-config</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>安装好后模块会被安装置 <code>/usr/lib64/php/modules/memcache.so</code></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/etc/php.d/</span></span><br><span class="line">cp mysql.ini memcache.ini           <span class="comment">#vim进行编辑将extension的值设置成memcache.so</span></span><br></pre></td></tr></table></figure><p>重启服务后可以看到php已经支持了memcache模块了</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/02.png" alt="02"></p><div id="0x08-php-jiao-ben-ce-shi-mo-kuai"></div><br><br><br><h1>0x08 php脚本测试模块</h1><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xf memcache_page<span class="selector-class">.tar</span><span class="selector-class">.gz</span> -C /var/www/html/</span><br><span class="line">cd !$</span><br></pre></td></tr></table></figure><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/03.png" alt="03"></p><p>测试页面有 mysql_connect.php 编辑一下</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/04.png" alt="04"></p><p>因此需要先把mysql的用户设置一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysqld  start</span><br><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><p>或者自己在数据库里</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all on *.* to &apos;root&apos;@&apos;127.0.0.1&apos; identified by &apos;123456&apos;</span><br><span class="line">flush privileges</span><br></pre></td></tr></table></figure><p>然后浏览器访问mysql_connect.php</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/05.png" alt="05"></p><p>对接成功, 下面写了两个典型的php调用 memcached 的例子</p><figure class="highlight php"><figcaption><span>read.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$memcachehost = <span class="string">'192.168.1.113'</span>;</span><br><span class="line">$memcacheport = <span class="number">11211</span>;</span><br><span class="line">$memcachelife = <span class="number">60</span>;<span class="comment">#memcache默认有效期</span></span><br><span class="line">$memcache = <span class="keyword">new</span> Memcache;</span><br><span class="line">$memcache-&gt;connect($memcachehost,$memcacheport) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Could not connect"</span>);<span class="comment">#连接memcache服务器</span></span><br><span class="line">$num=$_POST[<span class="string">"num"</span>];</span><br><span class="line">$db=db1;</span><br><span class="line">$tb=T1;</span><br><span class="line">$query=<span class="string">"select * from $tb where ID=$num"</span>;<span class="comment">#mysql查询语句</span></span><br><span class="line"><span class="comment">#$key=md5($query);</span></span><br><span class="line">$key=md5($num);<span class="comment">#对参数进行加密，可以看出memcache存储的值是进过加密的</span></span><br><span class="line"><span class="keyword">if</span>(!$memcache-&gt;get($key))<span class="comment">#尝试先从memcache取值，如果没有去数据库取，顺便给memcache来一份</span></span><br><span class="line">&#123;</span><br><span class="line">                $conn=mysql_connect(<span class="string">"127.0.0.1"</span>,<span class="string">"root"</span>,<span class="string">"123456"</span>);</span><br><span class="line">                mysql_select_db($db);</span><br><span class="line">                $result=mysql_query($query);</span><br><span class="line">                <span class="comment">#echo "mysql $num";</span></span><br><span class="line">                <span class="keyword">while</span> ($row=mysql_fetch_assoc($result))</span><br><span class="line">                &#123;</span><br><span class="line">                        $arr[]=$row;</span><br><span class="line">                &#125;</span><br><span class="line">                $f = <span class="string">'mysql'</span>;</span><br><span class="line">                $memcache-&gt;add($key,serialize($arr),<span class="number">0</span>,<span class="number">30</span>);</span><br><span class="line">                $data = $arr ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">        $f = <span class="string">'memcache'</span>;</span><br><span class="line">        $data_mem=$memcache-&gt;get($key);</span><br><span class="line">        $data = unserialize($data_mem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"$f $num"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"key is $key"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><figcaption><span>write.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$memcachehost = <span class="string">'192.168.1.113'</span>;</span><br><span class="line">$memcacheport = <span class="number">11211</span>;</span><br><span class="line">$memcachelife = <span class="number">60</span>;</span><br><span class="line">$memcache = <span class="keyword">new</span> Memcache;</span><br><span class="line">$memcache-&gt;connect($memcachehost,$memcacheport) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Could not connect"</span>);</span><br><span class="line">$num=$_POST[<span class="string">"num"</span>];</span><br><span class="line">$db=db1;</span><br><span class="line">$tb=T1;</span><br><span class="line">$query=<span class="string">"insert into $tb values($num)"</span>;</span><br><span class="line"><span class="comment">#$key=md5($query);</span></span><br><span class="line">$key=md5($num);</span><br><span class="line"><span class="keyword">if</span>(!$memcache-&gt;get($key))<span class="comment">//先尝试更新memcache，如果不存在，则再去更新数据库，同时更新存储到memcachce</span></span><br><span class="line">&#123;</span><br><span class="line">    $conn=mysql_connect(<span class="string">"127.0.0.1"</span>,<span class="string">"root"</span>,<span class="string">"123456"</span>);</span><br><span class="line">    mysql_select_db($db);</span><br><span class="line">    $result=mysql_query($query);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ($row=mysql_fetch_assoc($result))</span><br><span class="line">    &#123;</span><br><span class="line">            $arr[]=$row;</span><br><span class="line">    &#125;</span><br><span class="line">    $f = <span class="string">'mysql'</span>;</span><br><span class="line">    $memcache-&gt;add($key,serialize($arr),<span class="number">0</span>,<span class="number">30</span>);        <span class="comment">//mysql 插入成功后，插入 memcached</span></span><br><span class="line">    $data = $arr ;</span><br><span class="line"></span><br><span class="line">    $f1 = <span class="string">'memcache'</span>;</span><br><span class="line">    $data_mem=$memcache-&gt;get($key);</span><br><span class="line">    $data = unserialize($data_mem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"$f $f1 $num"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>关于php memcache简单用法参见: <a href="http://www.cnblogs.com/demonxian3/p/6868361.html" target="_blank" rel="noopener">http://www.cnblogs.com/demonxian3/p/6868361.html</a><br>上面两个php里可以看到调用了数据库的db1 和 表T1因此需要创建一下</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seq <span class="number">1</span> <span class="number">999</span> &gt; /tmp/sum#创建<span class="number">1</span><span class="number">-999</span>的测试数据</span><br></pre></td></tr></table></figure><p>连接数据库导入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db1; <span class="keyword">create</span> T1(<span class="keyword">id</span> <span class="built_in">int</span>)<span class="keyword">engine</span>=<span class="keyword">innodb</span>;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'/tmp/sum'</span> <span class="keyword">into</span> <span class="keyword">table</span> T1;  <span class="comment">#导入测试数据</span></span><br></pre></td></tr></table></figure><p>教个小技巧，调用历史命令，感叹号 + 历史号(通过histrory查看), 如:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">!111</span></span><br></pre></td></tr></table></figure><p>用浏览器来访问那个测试页面</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/06.png" alt="06"></p><p>测试读取数据，从数据库里查询出id为5的值</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/07.png" alt="07"></p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/08.png" alt="08"></p><p>后退再去取一次</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/09.png" alt="09"></p><p>测试写入数据</p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/10.png" alt="10"></p><p><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/17051801_memcache/11.png" alt="11"></p><p>最后给大家推荐一款很好用的memcache管理工具：<a href="http://www.junopen.com/memadmin/" target="_blank" rel="noopener">memadmin</a> 使用php写的</p><p>搭建memcache过程可能会出现的问题： 执行 memcached 启动命令时，报错，提示：</p><blockquote><p><font colo="red">error while loading shared libraries: libevent-2.1.so.6: cannot open shared object file: No such file or directory</font></p></blockquote><p>查看 memcached 命令缺失什么库</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd <span class="regexp">/usr/</span>local<span class="regexp">/memcached/</span>bin<span class="regexp">/memcached</span></span><br></pre></td></tr></table></figure><p>结果： libevent-2.1.so.6 模块找不到</p><p>查看 libevent-2.1.so.6 是否存在</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">locate</span> <span class="selector-tag">libevent-2</span><span class="selector-class">.1</span><span class="selector-class">.so</span><span class="selector-class">.6</span></span><br></pre></td></tr></table></figure><p>结果： 系统已经安装了该模块，在路径 /usr/local/lib/</p><p>查看 memcached 查找依赖库的路径</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_DEBUG=libs <span class="regexp">/usr/</span>local<span class="regexp">/memcached/</span>bin<span class="regexp">/memcached -v</span></span><br></pre></td></tr></table></figure><p>结果： 在 /lib64/ 目录中查找，所以找不到已经安装好的</p><p>映射 libevent-2.1.so.6 到 /lib64 路径中</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">libevent</span>-2.1.<span class="title">so</span>.6 /<span class="title">usr</span>/<span class="title">lib64</span>/<span class="title">libevent</span>-2.1.<span class="title">so</span>.6</span></span><br></pre></td></tr></table></figure><p>结果：这样处理后，memcached就可以搜索到该文件了</p><p>启动memcached服务</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/memcached restart</span></span><br></pre></td></tr></table></figure><div class="post-announce">感谢您的阅读，本文由 <a href="javascript:void;">Demon</a> 原创提供。如若转载，请注明出处：Demon（<a href="javascript:void;">javascript:void;</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2017/05/10/17051001_mqttser/" title="Mqtt服务搭建"><i class="iconfont icon-prev"></i>Mqtt服务搭建</a></div><div class="post__prev post__prev--right"><a href="/2017/05/18/17051801_svnser/" title="SVN 版本控制服务搭建">SVN 版本控制服务搭建<i class="iconfont icon-next"></i></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">技术文章</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/编程开发/">编程开发</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/系统安装/">系统安装</a><span class="block-list-count">4</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/服务搭建/">服务搭建</a><span class="block-list-count">7</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/技术杂谈/">技术杂谈</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/工具使用/">工具使用</a><span class="block-list-count">2</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/06/16/19061601_loadimg/" title="loadImage"><div class="item__cover"><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/cover/18082301_hello.png" alt="loadImage"></div><div class="item__info"><h3 class="item__title">loadImage</h3><span class="item__text">2019-06-16</span></div></a></li><li class="latest-post-item"><a href="/2018/08/24/18082401_markdown/" title="MarkDown 语法"><div class="item__cover"><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/cover/18082401_markdown.png" alt="MarkDown 语法"></div><div class="item__info"><h3 class="item__title">MarkDown 语法</h3><span class="item__text">2018-08-24</span></div></a></li><li class="latest-post-item"><a href="/2018/08/23/18082301_hello/" title="做自己的博客"><div class="item__cover"><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/cover/18082301_hello.png" alt="做自己的博客"></div><div class="item__info"><h3 class="item__title">做自己的博客</h3><span class="item__text">2018-08-23</span></div></a></li><li class="latest-post-item"><a href="/2018/08/22/18082201_webapp/" title="Web技术也能写App？"><div class="item__cover"><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/cover/18082201_webapp.png" alt="Web技术也能写App？"></div><div class="item__info"><h3 class="item__title">Web技术也能写App？</h3><span class="item__text">2018-08-22</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/git/">git</a></li><li class="tag-item"><a class="tag-link" href="/tags/linux/">linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/server/">server</a></li><li class="tag-item"><a class="tag-link" href="/tags/安卓/">安卓</a></li><li class="tag-item"><a class="tag-link" href="/tags/语言/">语言</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">希望能有一件事情能够坚持到底，十年后看看沉淀十年得结果</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Nanshanqu, Shenzhen, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>920248921@qq.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="https://blogimg-1252836741.cos.ap-chengdu.myqcloud.com/system/qrcode.png" alt="logo" title="Khazix"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/demonxian3" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="920248921@qq.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>